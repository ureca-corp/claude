# Pseudocode 템플릿

## 수도코드 작성 가이드

### 언제 수도코드가 필요한가?

#### 필요 (복잡한 로직)

- Cascade 처리 (연결 데이터 삭제)
- 다단계 검증
- 조건부 로직 (if/else 분기)
- 여러 엔티티 조회/수정
- 상태 전이 (FSM)
- 복잡한 계산
- 외부 API 호출 + 후처리
- 트랜잭션 관리

#### 불필요 (단순 로직)

- 단순 CRUD (생성, 조회, 수정, 삭제)
- 검증만 있는 경우
- 직접적인 데이터 반환

---

## 기본 구조

```markdown
### 수도코드

\`\`\`
1. {액션 1}
   - {세부사항 1-1}
   - {세부사항 1-2}

2. {액션 2}
   - {조건} 확인
   - 맞으면: {처리 A}
   - 아니면: {처리 B}

3. {액션 3}
   - {반복 처리}
   - 각 항목마다 {처리}

4. {결과 반환}
\`\`\`
```

---

## 순차 처리 템플릿

```markdown
\`\`\`
1. X를 조회한다

2. Y를 검증한다

3. Z를 처리한다

4. 결과를 반환한다
\`\`\`
```

### 예시: 프로필 조회

```markdown
\`\`\`
1. userId로 사용자를 조회한다
   - 없으면 404 오류 반환

2. 조회한 사용자 정보를 반환한다
\`\`\`
```

---

## 조건부 처리 템플릿

```markdown
\`\`\`
1. X를 확인한다
   - 맞으면: Y를 한다
   - 아니면: Z 오류 반환

2. A를 처리한다
\`\`\`
```

### 예시: 프로필 수정

```markdown
\`\`\`
1. userId로 사용자를 조회한다
   - 없으면 404 오류 반환

2. 요청자가 본인인지 확인한다
   - 본인이 아니면 403 오류 반환

3. 수정 가능한 필드만 업데이트한다
   - displayName
   - profileImage
   - preferredLanguage

4. 업데이트된 사용자 정보를 반환한다
\`\`\`
```

---

## 반복 처리 템플릿

```markdown
\`\`\`
1. 모든 X 목록을 조회한다

2. 각 X마다:
   - Y를 처리한다
   - Z를 기록한다

3. 처리된 개수를 반환한다
\`\`\`
```

### 예시: 회원 탈퇴 (Cascade)

```markdown
\`\`\`
1. userId로 사용자를 조회한다
   - 없으면 404 오류 반환

2. 요청자가 본인인지 확인한다
   - 본인이 아니면 403 오류 반환

3. 연결된 모든 데이터를 조회한다
   - 번역 기록 목록
   - 미션 진행 기록 목록

4. 연결 데이터를 모두 삭제한다
   - 번역 기록 삭제 (Cascade)
   - 미션 진행 기록 삭제 (Cascade)
   - 삭제된 개수를 기록

5. 사용자 엔티티를 삭제한다

6. 삭제 완료 메시지와 개수를 반환한다
\`\`\`
```

---

## 외부 API 호출 템플릿

```markdown
\`\`\`
1. X API에 Y를 요청한다
   - 성공하면: 결과를 저장
   - 실패하면: Z 오류 반환

2. 저장된 결과로 A를 처리한다

3. 처리 결과를 반환한다
\`\`\`
```

### 예시: 번역 요청

```markdown
\`\`\`
1. 번역 API에 텍스트를 요청한다
   - 입력: sourceText, targetLanguage
   - 성공하면: 번역 결과를 받음
   - 실패하면: 500 오류 반환

2. 번역 기록을 생성한다
   - userId: 요청자
   - sourceText: 원문
   - translatedText: 번역 결과
   - targetLanguage: 목표 언어
   - createdAt: 현재 시각

3. 생성된 번역 기록을 반환한다
\`\`\`
```

---

## 상태 전이 템플릿

```markdown
\`\`\`
1. 현재 상태를 확인한다

2. 요청한 상태로 전이 가능한지 검증한다
   - 가능하면: 다음 단계 진행
   - 불가능하면: 400 오류 반환 ("잘못된 상태 전이입니다")

3. 상태를 변경한다

4. 상태 변경 이벤트를 기록한다

5. 새로운 상태를 반환한다
\`\`\`
```

### 예시: 미션 완료

```markdown
\`\`\`
1. missionProgressId로 미션 진행 상태를 조회한다
   - 없으면 404 오류 반환

2. 현재 상태를 확인한다
   - 현재 상태: IN_PROGRESS

3. 완료 전이 가능 여부를 검증한다
   - IN_PROGRESS → COMPLETED 가능
   - 다른 상태면: 400 오류 반환 ("진행 중인 미션만 완료할 수 있습니다")

4. 완료 조건을 확인한다
   - 필요한 번역 개수 충족 여부
   - 충족하지 않으면: 400 오류 반환 ("아직 N개의 번역이 필요합니다")

5. 상태를 COMPLETED로 변경한다

6. 완료 시각(completedAt)을 기록한다

7. 보상을 지급한다 (있다면)

8. 업데이트된 미션 진행 상태를 반환한다
\`\`\`
```

---

## 트랜잭션 처리 템플릿

```markdown
\`\`\`
1. X를 시작한다

2. Y를 처리한다
   - 실패하면: 롤백 + 오류 반환

3. Z를 처리한다
   - 실패하면: 롤백 + 오류 반환

4. 트랜잭션을 확정한다

5. 결과를 반환한다
\`\`\`
```

### 예시: 주문 생성

```markdown
\`\`\`
1. 재고를 확인한다
   - 부족하면: 400 오류 반환 ("재고가 부족합니다")

2. 주문을 생성한다
   - userId: 구매자
   - items: 주문 항목 목록
   - totalAmount: 총 금액
   - status: PENDING

3. 재고를 차감한다
   - 각 주문 항목마다 재고 감소
   - 실패하면: 주문 롤백 + 500 오류 반환

4. 결제를 요청한다
   - 결제 API 호출
   - 실패하면: 주문 롤백 + 재고 복구 + 400 오류 반환

5. 주문 상태를 PAID로 변경한다

6. 생성된 주문 정보를 반환한다
\`\`\`
```

---

## 복잡한 계산 템플릿

```markdown
\`\`\`
1. 필요한 데이터를 모두 조회한다

2. 계산을 수행한다
   - {단계 1}
   - {단계 2}
   - {단계 3}

3. 계산 결과를 저장한다 (필요시)

4. 결과를 반환한다
\`\`\`
```

### 예시: 진행률 계산

```markdown
\`\`\`
1. missionId로 미션 정보를 조회한다
   - 필요한 번역 개수: requiredCount

2. userId와 missionId로 완료한 번역 개수를 조회한다
   - 완료한 번역 개수: completedCount

3. 진행률을 계산한다
   - progress = (completedCount / requiredCount) * 100
   - 소수점 첫째 자리까지 (예: 66.7%)

4. 진행 상태를 결정한다
   - progress == 0: NOT_STARTED
   - 0 < progress < 100: IN_PROGRESS
   - progress == 100: COMPLETED

5. 진행률 정보를 반환한다
   - progress: 66.7
   - completedCount: 4
   - requiredCount: 6
   - status: IN_PROGRESS
\`\`\`
```

---

## 작성 원칙

### ✅ 좋은 수도코드

- 번호로 단계 구분 (1, 2, 3...)
- 들여쓰기로 세부사항 표현 (-, •)
- 명확한 조건문 ("맞으면:", "아니면:")
- 구체적인 오류 메시지
- 한글 사용

**예시**:
```
1. userId로 사용자를 조회한다
   - 없으면 404 오류 반환

2. 요청자가 본인인지 확인한다
   - 본인이 아니면 403 오류 반환 ("본인만 수정할 수 있습니다")
```

### ❌ 나쁜 수도코드

- 번호 없이 나열
- 모호한 표현 ("처리한다", "검증한다")
- 기술 용어 사용
- 영어 사용

**예시**:
```
user = db.query(User).filter(User.id == userId).first()
if not user:
    raise HTTPException(status_code=404)
if user.id != request.user.id:
    raise HTTPException(status_code=403)
```

---

## 기술 용어 금지

**절대 사용 금지**:
- db.query, SELECT, INSERT, UPDATE
- HTTPException, raise, throw
- if/else (코드 문법)
- try/catch, transaction.begin()
- JSON.parse, response.json()

**대신 사용**:
- "조회한다", "생성한다", "수정한다"
- "오류 반환", "오류를 던진다"
- "맞으면:", "아니면:"
- "트랜잭션 시작", "롤백"
- "데이터 파싱", "결과를 받음"

---

## 완전한 예시

```markdown
## 4. 회원 탈퇴

### Request (요청)

| 필드명 | 타입 | 필수 | 설명 | 예시 | 검증 규칙 |
|--------|------|------|------|------|-----------|
| userId | 문자열 | O | 삭제할 사용자 ID | u_123abc | - |

### Response (응답)

#### 성공 (200)

| 필드명 | 타입 | 설명 | 예시 |
|--------|------|------|------|
| message | 문자열 | 완료 메시지 | 회원 탈퇴가 완료되었습니다 |
| deletedCount | 숫자 | 삭제된 연관 데이터 수 | 15 |

#### 오류

| 상태 | 조건 | 메시지 | 필드 예시 |
|------|------|--------|-----------|
| 404 | 사용자 없음 | 존재하지 않는 사용자입니다 | {"userId": "u_999"} |
| 403 | 권한 없음 | 본인만 탈퇴할 수 있습니다 | {"userId": "u_123abc"} |

### 수도코드

\`\`\`
1. userId로 사용자를 조회한다
   - 없으면 404 오류 반환 ("존재하지 않는 사용자입니다")

2. 요청자가 본인인지 확인한다
   - 본인이 아니면 403 오류 반환 ("본인만 탈퇴할 수 있습니다")

3. 연결된 모든 데이터를 조회한다
   - 번역 기록 목록
   - 미션 진행 기록 목록

4. 연결 데이터를 모두 삭제한다
   - 번역 기록 삭제 (Cascade)
   - 미션 진행 기록 삭제 (Cascade)
   - 삭제된 개수를 기록

5. 사용자 엔티티를 삭제한다

6. 삭제 완료 메시지와 개수를 반환한다
   - message: "회원 탈퇴가 완료되었습니다"
   - deletedCount: {삭제된 총 개수}
\`\`\`
```
