---
name: 1-clarifier
description: 요구사항 명확화 - 점진적 문서 업데이트 (모호함 제로까지)
---

# Phase 1: Clarifier

## 역할

사용자의 요구사항에서 **모든 모호함을 제거**하고 도메인 목록 확정

**철학**: "가정하지 말고, 질문하라"

---

## 점진적 업데이트 전략

**배치 크기**: 최대 4개 질문씩 (AskUserQuestion 제약)

```python
모호함_목록 = 초기_분석()

while len(모호함_목록) > 0:
    # 1. 다음 배치 선택 (최대 4개)
    배치 = 모호함_목록[:4]

    # 2. 사용자에게 질문
    답변 = AskUserQuestion(배치)

    # 3. 즉시 SESSION.md 업데이트 ⚡
    Edit(file_path=".claude/SESSION.md", ...)

    # 4. 새로운 모호함 확인
    모호함_목록 = 재분석()
```

---

## 작업 흐름

### Step 1: 초기 SESSION.md 생성

**최초 1회만** 파일 생성:

```markdown
# Domain Book 세션

> 생성일: {오늘 날짜}
> 플러그인: domain-book-builder v1.0.0
> 상태: 🚧 Phase 1 진행 중

---

## Phase 1: 요구사항 명확화 (진행 중...)

### 원본 요구사항

"{사용자의 원본 요청 그대로}"

### 탐지된 초기 모호함

{초기 분석 결과}

---

## 결정 사항 (점진적 업데이트)

> 배치 1 질문 준비 중...
```

**도구 사용**:
```python
Write(
    file_path=".claude/SESSION.md",
    content=initial_content
)
```

---

### Step 2: 모호함 분석

원본 요구사항에서 모호한 부분 식별:

**분석 카테고리**:
| 카테고리 | 질문 예시 |
|----------|----------|
| 범위 | "회원"이 정확히 무엇을 의미? |
| 기능 | "주문"에 결제가 포함? |
| 제약 | 언어 지원 범위는? |
| 사용자 | 타겟 사용자는? |
| 데이터 | 어떤 정보를 저장? |

**중요**: 기술 질문 금지!
- ❌ "데이터베이스는 PostgreSQL?"
- ❌ "인증은 JWT?"
- ✅ "인증이 필요한가요?"
- ✅ "어떤 정보를 저장할까요?"

---

### Step 3: 배치 1 질문

```python
AskUserQuestion(
    questions=[
        {
            "question": "프로젝트의 주요 목표는 무엇인가요?",
            "header": "프로젝트 목표",
            "multiSelect": False,
            "options": [
                {
                    "label": "신규 제품 개발",
                    "description": "완전히 새로운 제품"
                },
                {
                    "label": "기존 제품 개선",
                    "description": "기존 제품에 기능 추가"
                },
                {
                    "label": "MVP 검증",
                    "description": "아이디어 빠른 검증"
                }
            ]
        },
        {
            "question": "타겟 사용자는 누구인가요?",
            "header": "타겟 사용자",
            "multiSelect": True,
            "options": [
                {
                    "label": "일반 소비자",
                    "description": "B2C"
                },
                {
                    "label": "기업 고객",
                    "description": "B2B"
                }
            ]
        },
        {
            "question": "인증은 필요한가요?",
            "header": "인증 필요성",
            "multiSelect": False,
            "options": [
                {
                    "label": "필수",
                    "description": "회원제"
                },
                {
                    "label": "선택",
                    "description": "비회원도 이용 가능"
                },
                {
                    "label": "불필요",
                    "description": "공개 서비스"
                }
            ]
        }
        # 최대 4개
    ]
)
```

---

### Step 4: 배치 1 답변 즉시 반영 ⚡

**Edit 도구로 SESSION.md 업데이트**:

```python
old_string = """> 배치 1 질문 준비 중..."""

new_string = """### 배치 1 (완료 ✅)

| 질문 | 결정 |
|------|------|
| 프로젝트 목표 | MVP 검증 |
| 타겟 사용자 | 일반 소비자 (B2C) |
| 인증 필요성 | 필수 (회원제) |

### 진행률: 3/12 (25%)

---

### 새로운 모호함 발견

1. 회원 정보 범위?
2. 소셜 로그인 포함 여부?
3. ...

> 배치 2 질문 준비 중..."""

Edit(
    file_path=".claude/SESSION.md",
    old_string=old_string,
    new_string=new_string
)
```

**사용자 피드백**:
```
✅ 배치 1 완료 (3개 질문)
📝 SESSION.md 업데이트
📊 진행률: 25%
🔍 새로운 모호함 3개 발견

계속 진행합니다...
```

---

### Step 5: 배치 2, 3, ... 반복

**동일한 패턴**:
1. AskUserQuestion (최대 4개)
2. 답변 받기
3. 즉시 SESSION.md 업데이트 (Edit)
4. 진행률 표시
5. 새로운 모호함 확인

**반복 종료 조건**: 모호함 목록이 비어있을 때

---

### Step 6: 도메인 탐지

명확화 과정에서 언급된 키워드로 도메인 자동 탐지:

```python
# 예시
언급된_키워드 = ["회원", "번역", "미션", "추천 문장"]

도메인_매핑 = {
    "회원": "users",
    "번역": "translations",
    "미션": "missions",
    "추천 문장": "phrases"
}

탐지된_도메인 = ["users", "translations", "missions", "phrases"]
```

---

### Step 7: 최종 정리

모든 모호함 해결 후 SESSION.md 최종 업데이트:

```python
old_string = """> 상태: 🚧 Phase 1 진행 중"""

new_string = """> 상태: ✅ Phase 1 완료"""

Edit(file_path=".claude/SESSION.md", ...)

# 도메인 목록 추가
old_string = """### 진행률: 12/12 (100%)"""

new_string = """### 진행률: 12/12 (100%)

---

## 탐지된 도메인

| 도메인 | 설명 | 키워드 |
|--------|------|--------|
| users | 회원 관리 | 회원, 프로필, 인증 |
| translations | 번역 기록 | 번역, 텍스트, 음성 |
| missions | 미션 시스템 | 미션, 가이드, 단계 |
| phrases | 추천 문장 | 문장, 템플릿, 표현 |

---

## Phase 1 완료 ✅

**명확화된 요구사항**:
- 프로젝트 목표: {요약}
- 타겟 사용자: {요약}
- 핵심 기능: {요약}
- 제약조건: {요약}

**다음 단계**: Phase 2 (Interviewer)"""

Edit(file_path=".claude/SESSION.md", ...)
```

---

### Step 8: 사용자 승인 요청

```
╔══════════════════════════════════════════════════════════╗
║           PHASE 1 완료: 요구사항 명확화                   ║
╠══════════════════════════════════════════════════════════╣
║                                                          ║
║ 탐지된 도메인: 4개                                       ║
║   - users (회원 관리)                                    ║
║   - translations (번역 기록)                             ║
║   - missions (미션 시스템)                               ║
║   - phrases (추천 문장)                                  ║
║                                                          ║
║ 해결된 모호함: 12개                                      ║
║ 진행률: 100%                                             ║
║                                                          ║
╠══════════════════════════════════════════════════════════╣
║ 📄 .claude/SESSION.md를 확인해주세요.                    ║
║                                                          ║
║ Phase 2 (도메인 인터뷰)로 진행할까요?                    ║
╚══════════════════════════════════════════════════════════╝
```

**AskUserQuestion**:
```python
{
    "question": "Phase 1 결과를 확인했습니다. Phase 2로 진행할까요?",
    "header": "Phase 1 승인",
    "multiSelect": False,
    "options": [
        {
            "label": "승인 - Phase 2 진행",
            "description": "도메인별 상세 인터뷰 시작"
        },
        {
            "label": "수정 필요",
            "description": "요구사항 다시 명확화"
        }
    ]
}
```

---

## 최종 SESSION.md 구조 예시

```markdown
# Domain Book 세션

> 생성일: 2026-01-28
> 플러그인: domain-book-builder v1.0.0
> 상태: ✅ Phase 1 완료

---

## Phase 1: 요구사항 명확화 (완료 ✅)

### 원본 요구사항

"외국인 여행자용 번역 앱 만들어줘"

---

## 결정 사항 (점진적 업데이트)

### 배치 1 (완료 ✅)

| 질문 | 결정 |
|------|------|
| 프로젝트 목표 | MVP 검증 |
| 타겟 사용자 | 일반 소비자 (외국인 여행자) |
| 인증 필요성 | 필수 (회원제) |

### 배치 2 (완료 ✅)

| 질문 | 결정 |
|------|------|
| 회원 정보 | 이름, 이메일, 프로필 사진, 선호 언어 |
| 소셜 로그인 | Google, Apple |
| 번역 히스토리 | 영구 저장 |

### 배치 3 (완료 ✅)

| 질문 | 결정 |
|------|------|
| 언어 지원 | 한국어, 영어만 (MVP) |
| 음성 번역 | 포함 (텍스트 + 음성) |
| 미션 종류 | 택시, 결제, 체크인 (3종) |

### 진행률: 9/9 (100%)

---

## 탐지된 도메인

| 도메인 | 설명 | 키워드 |
|--------|------|--------|
| users | 회원 관리 | 회원, 프로필, 인증 |
| translations | 번역 기록 | 번역, 텍스트, 음성 |
| missions | 미션 시스템 | 미션, 가이드, 단계 |
| phrases | 추천 문장 | 문장, 템플릿, 표현 |

---

## Phase 1 완료 ✅

**명확화된 요구사항**:
- 프로젝트 목표: 외국인 여행자의 한국 여행 언어 장벽 해소
- 타겟 사용자: 영어권 여행자
- 핵심 기능: 실시간 번역(텍스트/음성), 미션 가이드, 추천 문장
- 제약조건: 한국어/영어만, 온라인 필수

**다음 단계**: Phase 2 (Interviewer)
```

---

## 완료 조건

- [ ] 모든 모호함 해결 (0개)
- [ ] **각 배치마다 SESSION.md 즉시 업데이트** ⚡
- [ ] 도메인 목록 확정
- [ ] 기술 질문 0개 (중요!)
- [ ] 사용자 승인 완료

---

## 출력 파일

- `.claude/SESSION.md`

---

## 주의사항

### ✅ 좋은 질문 (기술 독립)
- "회원은 어떤 정보를 가지나요?"
- "주문 취소는 언제까지 가능한가요?"
- "지원할 언어는?"
- "미션 종류는 몇 개인가요?"

### ❌ 나쁜 질문 (기술 종속)
- "인증은 JWT인가요?"
- "데이터베이스는 PostgreSQL인가요?"
- "이미지는 S3에 저장할까요?"
- "번역은 Google Cloud API인가요?"

→ **기술 구현은 나중에!** 지금은 순수 도메인 지식만.
