# missions 도메인 비즈니스 규칙

## 데이터 규칙

### 규칙 1: 미션 타입 제한
**설명**: 초기 버전은 택시, 결제, 체크인 3가지 미션 타입만 지원합니다.
**예시**: 사용자는 "taxi", "payment", "checkin" 중 하나만 선택할 수 있습니다.
**위반 시**: 다른 타입(예: "shopping")은 "INVALID_INPUT" 오류로 거부됩니다.

---

### 규칙 2: 단계 수 범위
**설명**: 각 미션은 3-7개의 단계를 가집니다. 택시는 3단계, 결제는 4단계 등으로 미션 타입마다 다릅니다.
**예시**: 택시 미션은 "목적지 설정", "택시 호출", "운전자에게 목적지 전달" 3단계로 구성됩니다.
**위반 시**: 3단계 미만이나 7단계 초과는 허용되지 않습니다.

---

### 규칙 3: 현재 단계 범위 검증
**설명**: 현재 단계는 1부터 전체 단계 수 사이의 값이어야 합니다.
**예시**: 3단계 미션에서 currentStep은 1, 2, 3 중 하나여야 합니다.
**위반 시**: 0이나 4 이상의 값은 "INVALID_STEP" 오류로 거부됩니다.

---

## 생명주기 규칙

### 규칙 4: 한 번에 하나의 미션만 진행 가능
**설명**: 사용자는 동시에 여러 미션을 진행할 수 없으며, 진행중인 미션을 완료하거나 취소해야 새 미션을 시작할 수 있습니다.
**예시**: 택시 미션이 진행중일 때 결제 미션을 시작하려고 하면 "이미 진행중인 미션이 있습니다" 메시지가 표시됩니다.
**위반 시**: 진행중인 미션이 있으면 새 미션 시작이 차단됩니다.

---

### 규칙 5: 순차 진행 권장
**설명**: 미션 단계는 순서대로 진행하는 것이 권장되지만, 사용자는 "이전 단계" 버튼으로 자유롭게 이동할 수 있습니다.
**예시**: 2단계에서 3단계로 진행했다가 다시 2단계로 돌아갈 수 있습니다.
**위반 시**: 단계를 건너뛸 수는 없지만, 이전 단계로 돌아가는 것은 허용됩니다.

---

### 규칙 6: 미션 완료 시 결과 필수
**설명**: 미션을 완료할 때는 반드시 결과(해결/부분해결/미해결)를 선택해야 합니다.
**예시**: 택시 미션을 종료할 때 "해결" 버튼을 눌러야 완료됩니다.
**위반 시**: 결과 없이 완료 시도하면 "INVALID_INPUT" 오류가 발생합니다.

---

### 규칙 7: 취소된 미션은 재개 불가
**설명**: 한 번 취소된 미션은 다시 진행할 수 없으며, 새 미션을 시작해야 합니다.
**예시**: 결제 미션을 취소하고 나중에 다시 결제 미션을 시작하면 새로운 미션으로 처리됩니다.
**위반 시**: 취소된 미션은 기록으로만 남습니다.

---

## 동기화 규칙

### 규칙 8: 서버 실시간 동기화
**설명**: 미션 상태와 현재 단계는 변경될 때마다 즉시 서버에 저장됩니다.
**예시**: 사용자가 "다음 단계" 버튼을 누르면 currentStep이 서버에 즉시 업데이트됩니다.
**위반 시**: 네트워크 오류 시 변경사항이 큐에 쌓여 나중에 동기화됩니다.

---

### 규칙 9: 여러 기기에서 이어하기
**설명**: 사용자는 스마트폰에서 시작한 미션을 태블릿이나 다른 기기에서 이어서 진행할 수 있습니다.
**예시**: 스마트폰에서 택시 미션 2단계까지 진행하고, 태블릿으로 접속하면 2단계부터 시작됩니다.
**위반 시**: 동기화되지 않으면 기기별로 미션이 분리될 수 있습니다.

---

## 제약 조건

### 규칙 10: 미션 타입 확장 가능
**설명**: 초기 3종(택시/결제/체크인) 외에 향후 "음식주문", "쇼핑", "병원" 등의 미션을 추가할 수 있습니다.
**예시**: 미션 타입은 하드코딩이 아닌 데이터베이스에서 관리되어 쉽게 확장 가능합니다.
**위반 시**: 코드 수정 없이 새 미션 타입 추가가 가능합니다.

---

### 규칙 11: 단계 템플릿 관리
**설명**: 각 미션 타입의 단계는 템플릿으로 관리되며, 관리자가 추가하거나 수정할 수 있습니다.
**예시**: 택시 미션에 "팁 주기" 단계를 추가하면, 이후 생성되는 모든 택시 미션에 자동 반영됩니다.
**위반 시**: 이미 생성된 미션에는 영향을 주지 않습니다.

---

## 연계 규칙

### 규칙 12: 미션과 번역 기록 연계
**설명**: 미션 진행 중 번역 기능을 사용하면 번역 기록에 미션 ID가 함께 저장됩니다.
**예시**: 택시 미션 중 "여기서 내려주세요"를 번역하면 해당 번역 기록에 택시 미션 ID가 저장됩니다.
**위반 시**: 미션 없이 번역해도 문제없이 작동합니다.

---

### 규칙 13: 미션과 추천 문장 연계
**설명**: 각 미션 타입에는 해당 타입에 맞는 추천 문장만 제공됩니다.
**예시**: 택시 미션에서는 "여기서 내려주세요" 같은 택시용 추천 문장만 표시되고, 결제용 추천 문장은 표시되지 않습니다.
**위반 시**: 다른 타입의 추천 문장은 필터링됩니다.

---

### 규칙 14: 미션과 경로 연계
**설명**: 택시 미션에서 경로를 설정하면 해당 경로에 미션 ID가 저장됩니다.
**예시**: 택시 미션 1단계("목적지 설정")에서 지도로 경로를 검색하면, 경로 정보에 택시 미션 ID가 함께 저장됩니다.
**위반 시**: 경로 없이도 택시 미션은 진행 가능합니다.

---

## 권한 규칙

### 규칙 15: 본인 미션만 관리 가능
**설명**: 사용자는 자신의 미션만 시작, 진행, 완료할 수 있으며, 다른 사용자의 미션은 접근할 수 없습니다.
**예시**: 사용자 A는 자신의 택시 미션만 진행하고, 사용자 B의 미션은 볼 수 없습니다.
**위반 시**: 다른 사용자의 미션 접근 시도는 "UNAUTHORIZED" 오류로 거부됩니다.

---

## 성능 규칙

### 규칙 16: 단계 변경 즉시 반영
**설명**: 사용자가 "다음 단계" 버튼을 누르면 1초 이내에 새 단계가 화면에 반영되어야 합니다.
**예시**: 1단계에서 2단계로 이동할 때 서버 응답이 1초 이내에 완료됩니다.
**위반 시**: 네트워크 지연 시 로딩 스피너가 표시됩니다.
