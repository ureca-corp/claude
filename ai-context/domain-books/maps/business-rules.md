# maps 도메인 비즈니스 규칙

## 데이터 규칙

### 규칙 1: 출발지와 목적지 필수
**설명**: 경로를 생성하려면 출발지와 목적지가 반드시 필요합니다.
**예시**: 출발지 "현재 위치", 목적지 "명동"을 입력해야 경로 검색이 가능합니다.
**위반 시**: 출발지나 목적지가 없으면 "INVALID_INPUT" 오류가 발생합니다.

---

### 규칙 2: 현재 위치 허용
**설명**: 출발지는 "현재 위치"로 설정할 수 있으며, 이 경우 GPS 좌표를 사용합니다.
**예시**: 출발지를 "CURRENT_LOCATION"으로 설정하면 클라이언트에서 전달한 GPS 좌표가 사용됩니다.
**위반 시**: GPS 권한이 없으면 현재 위치를 사용할 수 없습니다.

---

### 규칙 3: 즐겨찾기 필수 필드
**설명**: 즐겨찾기 장소에는 장소 이름, 주소, 사용자 별칭이 반드시 포함되어야 합니다.
**예시**: 장소 이름 "명동", 주소 "서울특별시 중구 명동2가", 별칭 "숙소"가 모두 저장됩니다.
**위반 시**: 필수 필드가 없으면 즐겨찾기가 생성되지 않습니다.

---

### 규칙 4: 검색 기록 자동 생성
**설명**: 사용자가 장소를 검색하면 검색 기록이 자동으로 저장됩니다. 사용자가 직접 추가할 수 없습니다.
**예시**: "명동"을 검색하면 SearchHistory에 자동으로 "명동"과 검색 시각이 저장됩니다.
**위반 시**: 사용자가 수동으로 검색 기록을 추가하려는 시도는 무시됩니다.

---

## 생명주기 규칙

### 규칙 5: 경로 정보 저장
**설명**: 경로 검색 결과는 서버에 저장되어 나중에 다시 확인할 수 있습니다.
**예시**: 택시 미션 중 검색한 "서울역 → 명동" 경로는 Route 엔티티로 저장됩니다.
**위반 시**: 미션이 종료되어도 경로 기록은 보관됩니다.

---

### 규칙 6: 검색 기록 최대 10개
**설명**: 검색 기록은 최근 10개까지만 보관되며, 10개를 초과하면 가장 오래된 것이 자동 삭제됩니다.
**예시**: 11번째 장소를 검색하면 첫 번째 검색 기록이 자동으로 삭제됩니다.
**위반 시**: 사용자가 직접 삭제할 수 없으며, 시스템이 자동 관리합니다.

---

### 규칙 7: 즐겨찾기 최대 20개
**설명**: 한 사용자는 최대 20개까지 즐겨찾기 장소를 저장할 수 있습니다.
**예시**: 19개가 저장된 상태에서 20번째를 추가할 수 있지만, 21번째는 추가할 수 없습니다.
**위반 시**: 20개 초과 시 "LIMIT_EXCEEDED" 오류가 발생합니다.

---

### 규칙 8: 사용자 탈퇴 시 데이터 처리
**설명**: 사용자가 탈퇴하면 검색 기록과 즐겨찾기는 완전히 삭제되지만, Route는 익명화되어 보관됩니다.
**예시**: 탈퇴 시 "명동" 검색 기록과 "숙소" 즐겨찾기는 삭제되지만, 택시 미션의 경로는 익명으로 보관됩니다.
**위반 시**: 개인 식별 가능한 검색/즐겨찾기 데이터는 모두 제거됩니다.

---

## 제약 조건

### 규칙 9: 지도 API 프록시 사용
**설명**: 네이버 지도 API는 반드시 서버 프록시를 통해 호출해야 하며, 클라이언트에서 직접 호출할 수 없습니다.
**예시**: 클라이언트는 서버의 `/maps/routes` API를 호출하고, 서버가 네이버 API를 대신 호출합니다.
**위반 시**: API 키가 노출되면 보안 문제가 발생합니다.

---

### 규칙 10: 경로 검색 실패 처리
**설명**: 네이버 지도 API 호출이 실패하면 "경로를 찾을 수 없습니다" 메시지를 표시하고 재시도를 안내합니다.
**예시**: 잘못된 주소 "asdfasdf"를 입력하면 API가 null을 반환하고 오류 메시지가 표시됩니다.
**위반 시**: 사용자는 주소를 수정하고 다시 검색해야 합니다.

---

### 규칙 11: 택시 요금 추정
**설명**: 경로 검색 시 거리 기반으로 택시 요금을 간단히 추정하여 제공합니다. 정확한 요금은 택시 앱을 참조해야 합니다.
**예시**: 1.2km 경로는 기본요금 + 거리 요금으로 약 4,000원으로 계산됩니다.
**위반 시**: 실제 요금은 시간대, 교통 상황 등에 따라 다를 수 있습니다.

---

## 성능 규칙

### 규칙 12: 경로 검색 응답 시간
**설명**: 경로 검색은 3초 이내에 완료되어야 합니다.
**예시**: 사용자가 "명동"을 검색하면 3초 이내에 경로 요약이 표시됩니다.
**위반 시**: 네이버 API 지연 시 타임아웃 메시지가 표시됩니다.

---

### 규칙 13: 즐겨찾기 조회 캐싱
**설명**: 즐겨찾기 목록은 클라이언트에 캐싱되어 매번 서버 요청이 불필요합니다.
**예시**: 즐겨찾기를 한 번 조회하면 앱이 종료될 때까지 캐시에서 표시됩니다.
**위반 시**: 즐겨찾기 추가/삭제 시 캐시를 갱신해야 합니다.

---

## 연계 규칙

### 규칙 14: 미션과 경로 연계
**설명**: 택시 미션 중 경로를 검색하면 Route에 미션 ID가 함께 저장됩니다.
**예시**: 택시 미션 ID "m_abc123"을 경로 생성 시 전달하면 Route.missionId에 저장됩니다.
**위반 시**: 미션 없이 경로를 검색해도 정상 작동합니다.

---

### 규칙 15: 검색 기록과 즐겨찾기 분리
**설명**: 검색 기록은 자동 관리되고, 즐겨찾기는 수동 관리됩니다. 두 기능은 독립적으로 작동합니다.
**예시**: "명동"을 검색하면 검색 기록에 추가되지만, 즐겨찾기에는 자동 추가되지 않습니다.
**위반 시**: 사용자가 명시적으로 즐겨찾기 추가 버튼을 눌러야 합니다.

---

## 권한 규칙

### 규칙 16: 본인 데이터만 관리 가능
**설명**: 사용자는 자신의 즐겨찾기와 검색 기록만 조회하고 관리할 수 있습니다.
**예시**: 사용자 A는 자신의 즐겨찾기만 보고, 사용자 B의 즐겨찾기는 접근할 수 없습니다.
**위반 시**: 다른 사용자의 데이터 접근 시도는 "UNAUTHORIZED" 오류로 거부됩니다.

---

### 규칙 17: GPS 권한 필요
**설명**: 현재 위치를 출발지로 사용하려면 앱에 GPS 권한이 필요합니다.
**예시**: 사용자가 GPS 권한을 허용하면 "현재 위치"를 출발지로 선택할 수 있습니다.
**위반 시**: GPS 권한이 없으면 수동으로 출발지를 입력해야 합니다.

---

## 외부 연계 규칙

### 규칙 18: 외부 지도 앱 연계
**설명**: 사용자는 경로 확인 후 네이버 지도, 구글 맵 등 외부 앱으로 경로를 전달할 수 있습니다.
**예시**: "외부 지도에서 보기" 버튼을 누르면 Deep Link로 네이버 지도 앱이 실행됩니다.
**위반 시**: 외부 앱이 설치되지 않았으면 웹 브라우저로 열립니다.

---

### 규칙 19: Deep Link 형식
**설명**: 외부 지도 앱 연계 시 표준 Deep Link 형식을 사용합니다.
**예시**: 네이버 지도는 "nmap://route/public?slat=37.5665&slng=126.9780&dlat=37.5636&dlng=126.9864" 형식을 사용합니다.
**위반 시**: 잘못된 형식은 외부 앱에서 열리지 않습니다.
