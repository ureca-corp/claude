# users 도메인 비즈니스 규칙

## 데이터 규칙

### 규칙 1: 이메일 유일성
**설명**: 동일한 이메일로 여러 계정을 만들 수 없습니다.
**예시**: "john@gmail.com"으로 이미 가입된 경우, 같은 이메일로 다시 가입하면 로그인 처리됩니다.
**위반 시**: 중복 가입 불가, 자동으로 로그인 처리

---

### 규칙 2: 필수 필드 자동 생성
**설명**: ID는 시스템이 자동으로 생성하며, 사용자가 직접 지정할 수 없습니다.
**예시**: 회원가입 시 "u_abc123" 형식의 고유 ID가 자동으로 부여됩니다.
**위반 시**: 사용자가 ID를 직접 입력하면 무시됩니다.

---

### 규칙 3: 선호 언어 기본값
**설명**: 선호 언어는 회원가입 시 기본값으로 "en" (영어)가 설정됩니다.
**예시**: 소셜 로그인 직후 선호 언어는 영어로 설정되며, 사용자가 나중에 한국어로 변경할 수 있습니다.
**위반 시**: 기본값이 없으면 시스템이 "en"을 자동 설정

---

## 생명주기 규칙

### 규칙 4: 소셜 로그인 필수
**설명**: 회원가입은 반드시 Google 또는 Apple 소셜 로그인을 통해서만 가능합니다. 이메일/비밀번호 방식은 지원하지 않습니다.
**예시**: 사용자는 Google 또는 Apple 계정으로만 가입하고 로그인할 수 있습니다.
**위반 시**: 다른 방식의 가입 시도는 거부됩니다.

---

### 규칙 5: 탈퇴 시 Soft Delete
**설명**: 회원 탈퇴 시 계정은 완전히 삭제되지 않고 비활성화(Soft Delete)됩니다. 이메일과 이름은 익명화되지만 ID는 유지됩니다.
**예시**: 탈퇴한 사용자의 이메일은 "deleted_user_u_123"으로 변경되고, 표시 이름은 "탈퇴한 사용자"로 변경됩니다.
**위반 시**: 탈퇴 후 번역/미션 기록은 익명으로 보관됩니다.

---

### 규칙 6: 탈퇴 후 데이터 처리
**설명**: 탈퇴 시 번역 기록과 미션 기록은 익명화되어 보관되지만, 검색 기록과 즐겨찾기는 완전히 삭제됩니다.
**예시**: 사용자가 탈퇴하면 "명동" 검색 기록과 "숙소" 즐겨찾기는 완전히 삭제되지만, "안녕하세요 → Hello" 번역 기록은 익명으로 보관됩니다.
**위반 시**: 개인 식별 가능한 데이터는 모두 제거됩니다.

---

## 권한 규칙

### 규칙 7: 본인 프로필만 수정 가능
**설명**: 프로필 수정은 본인만 가능하며, 다른 사용자나 관리자도 수정할 수 없습니다.
**예시**: 사용자 A는 자신의 표시 이름을 변경할 수 있지만, 사용자 B의 프로필은 변경할 수 없습니다.
**위반 시**: 다른 사용자의 프로필 수정 시도는 "FORBIDDEN" 오류로 거부됩니다.

---

### 규칙 8: 관리자도 프로필 수정 불가
**설명**: 관리자는 사용자 프로필을 수정할 수 없습니다. 사용자의 프라이버시를 보호하기 위함입니다.
**예시**: 관리자는 사용자 목록을 조회할 수 있지만, 표시 이름이나 선호 언어를 변경할 수 없습니다.
**위반 시**: 관리자의 프로필 수정 시도는 거부됩니다.

---

## 제약 조건

### 규칙 9: ID와 이메일 변경 불가
**설명**: 사용자 ID와 이메일은 한 번 생성되면 변경할 수 없습니다.
**예시**: 회원가입 시 부여된 "u_abc123" ID와 "john@gmail.com" 이메일은 평생 변경되지 않습니다.
**위반 시**: ID나 이메일 변경 요청은 무시됩니다.

---

### 규칙 10: 소셜 토큰 검증 필수
**설명**: 소셜 로그인 시 제공된 토큰은 반드시 소셜 제공자(Google/Apple) API를 통해 검증되어야 합니다.
**예시**: Google 로그인 토큰을 받으면 Google API로 토큰의 유효성을 확인한 후 회원가입 또는 로그인을 처리합니다.
**위반 시**: 잘못된 토큰은 "INVALID_TOKEN" 오류로 거부됩니다.

---

### 규칙 11: 선호 언어 제한
**설명**: 선호 언어는 한국어("ko") 또는 영어("en")만 지원합니다.
**예시**: 사용자는 선호 언어를 "ko" 또는 "en"으로만 설정할 수 있습니다.
**위반 시**: 다른 언어 코드 입력 시 "INVALID_INPUT" 오류가 반환됩니다.

---

### 규칙 12: 활성 계정만 로그인 가능
**설명**: 탈퇴한 사용자(Status = "Deleted")는 로그인할 수 없습니다.
**예시**: 탈퇴 후 같은 이메일로 로그인 시도하면 새 계정으로 가입 처리됩니다.
**위반 시**: 탈퇴 계정으로 로그인 시도 시 새 계정 생성됩니다.
