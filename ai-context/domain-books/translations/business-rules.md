# translations 도메인 비즈니스 규칙

## 데이터 규칙

### 규칙 1: 번역 기록 불변성
**설명**: 번역 기록은 한 번 생성되면 수정하거나 삭제할 수 없습니다.
**예시**: "안녕하세요 → Hello" 번역 기록이 저장되면, 내용을 변경할 수 없습니다.
**위반 시**: 수정 또는 삭제 요청은 거부됩니다.

---

### 규칙 2: 필수 필드
**설명**: 번역 기록에는 원문(SourceText)과 번역문(TargetText)이 반드시 포함되어야 합니다.
**예시**: "안녕하세요"(원문)와 "Hello"(번역문)가 모두 저장되어야 합니다.
**위반 시**: 원문이나 번역문이 없으면 번역 기록이 생성되지 않습니다.

---

### 규칙 3: 음성 파일 선택 저장
**설명**: 음성 파일은 음성 번역을 사용한 경우에만 저장됩니다. 텍스트 번역에는 음성 파일이 없습니다.
**예시**: 텍스트로 "안녕하세요"를 입력하면 audioFileUrl은 null이지만, 음성으로 녹음하면 Cloud Storage URL이 저장됩니다.
**위반 시**: 텍스트 번역에서는 audioFileUrl이 항상 null입니다.

---

### 규칙 4: 미션 ID 선택 필드
**설명**: 번역 기록은 미션에 속할 수도 있고, 독립적으로 사용할 수도 있습니다.
**예시**: 택시 미션 중 번역하면 missionId가 "m_abc123"으로 저장되지만, 일상 대화를 번역하면 missionId는 null입니다.
**위반 시**: 미션 없이도 번역은 정상적으로 작동합니다.

---

## 생명주기 규칙

### 규칙 5: STT 실패 시 재시도
**설명**: 음성을 텍스트로 변환하는 STT가 실패하면, 시스템은 자동 재시도하지 않고 사용자에게 알립니다. 사용자가 다시 녹음해야 합니다.
**예시**: 시끄러운 환경에서 음성을 녹음하면 STT가 실패하고 "음성을 인식할 수 없습니다" 메시지가 표시됩니다.
**위반 시**: 사용자는 다시 마이크 버튼을 눌러 재녹음해야 합니다.

---

### 규칙 6: 번역 기록 영구 저장
**설명**: 모든 번역 기록은 영구적으로 저장되며, 사용자가 탈퇴해도 익명화되어 보관됩니다.
**예시**: 사용자가 탈퇴하면 번역 기록의 사용자 정보는 익명으로 변경되지만, "안녕하세요 → Hello" 기록은 통계 목적으로 보관됩니다.
**위반 시**: 사용자가 직접 삭제할 수 없습니다.

---

### 규칙 7: 음성 파일 Cloud Storage 저장
**설명**: 녹음된 음성 파일은 데이터베이스에 직접 저장하지 않고 Cloud Storage에 업로드한 후 URL만 DB에 저장합니다.
**예시**: 녹음 파일은 "https://storage.cloud.com/audio_123.wav" 형식의 URL로 저장됩니다.
**위반 시**: 음성 파일이 DB에 직접 저장되면 성능 문제가 발생할 수 있습니다.

---

## 제약 조건

### 규칙 8: 지원 언어 제한
**설명**: 초기 버전은 한국어(ko), 영어(en), 일본어(ja), 중국어(zh)만 지원합니다.
**예시**: 사용자는 한국어 → 영어, 영어 → 한국어 등의 조합으로 번역할 수 있습니다.
**위반 시**: 지원하지 않는 언어 코드(예: "fr")는 "INVALID_INPUT" 오류로 거부됩니다.

---

### 규칙 9: 번역 API 의존성
**설명**: 번역 결과는 외부 번역 API(Google Translate, Papago 등)에 의존합니다. API 장애 시 번역이 불가능합니다.
**예시**: 번역 API 서버가 다운되면 "번역 서비스 오류가 발생했습니다" 메시지가 표시됩니다.
**위반 시**: API 오류 시 사용자는 나중에 다시 시도해야 합니다.

---

### 규칙 10: 번역 기록 조회 페이징
**설명**: 번역 기록이 많을 경우 페이징을 통해 20개씩 조회합니다.
**예시**: 첫 번째 요청에서 최근 20개를 가져오고, 스크롤하면 다음 20개를 추가로 가져옵니다.
**위반 시**: 한 번에 모든 기록을 가져오면 성능 문제가 발생할 수 있습니다.

---

## 권한 규칙

### 규칙 11: 본인 번역 기록만 조회 가능
**설명**: 사용자는 자신의 번역 기록만 조회할 수 있으며, 다른 사용자의 기록은 볼 수 없습니다.
**예시**: 사용자 A는 자신의 번역 기록만 보고, 사용자 B의 번역 기록은 접근할 수 없습니다.
**위반 시**: 다른 사용자의 번역 기록 조회 시도는 "UNAUTHORIZED" 오류로 거부됩니다.

---

## 성능 규칙

### 규칙 12: 번역 응답 시간
**설명**: 텍스트 번역은 3초 이내, 음성 번역은 5초 이내에 완료되어야 합니다.
**예시**: 사용자가 "안녕하세요"를 입력하고 번역 버튼을 누르면 3초 이내에 "Hello"가 표시됩니다.
**위반 시**: 응답 시간이 초과되면 타임아웃 메시지가 표시됩니다.

---

### 규칙 13: 음성 파일 크기 제한
**설명**: 녹음 파일은 최대 10MB까지 허용됩니다. 일반적으로 1분 이내 녹음은 1MB 이하입니다.
**예시**: 30초 음성 녹음은 약 500KB로 저장됩니다.
**위반 시**: 10MB를 초과하면 "파일 크기가 너무 큽니다" 오류가 발생합니다.
