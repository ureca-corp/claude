# phrases 도메인 비즈니스 규칙

## 데이터 규칙

### 규칙 1: 미션 타입별 그룹화
**설명**: 추천 문장은 반드시 미션 타입(택시/결제/체크인) 중 하나에 속해야 합니다.
**예시**: "여기서 내려주세요"는 택시 타입, "카드 되나요?"는 결제 타입에 속합니다.
**위반 시**: 미션 타입이 없는 추천 문장은 생성할 수 없습니다.

---

### 규칙 2: 한국어와 영어 필수
**설명**: 모든 추천 문장은 한국어와 영어 번역이 반드시 포함되어야 합니다.
**예시**: "여기서 내려주세요" (한국어)와 "Please drop me off here" (영어)가 함께 저장됩니다.
**위반 시**: 한국어나 영어가 없으면 추천 문장 생성이 거부됩니다.

---

### 규칙 3: 음성 파일 선택 제공
**설명**: 음성 파일(TTS)은 선택 사항이지만, 미리 생성하면 성능이 향상됩니다.
**예시**: 관리자가 추천 문장을 생성할 때 TTS API로 음성을 미리 만들어 Cloud Storage에 저장합니다.
**위반 시**: 음성이 없으면 클라이언트에서 실시간 TTS를 호출합니다.

---

### 규칙 4: 카테고리 분류
**설명**: 추천 문장은 인사, 요청, 질문, 응답, 긴급 등의 카테고리로 분류됩니다.
**예시**: "안녕하세요"는 인사, "여기서 내려주세요"는 요청, "얼마예요?"는 질문 카테고리입니다.
**위반 시**: 카테고리가 없어도 문장은 정상 작동하지만 분류 기능이 제한됩니다.

---

## 생명주기 규칙

### 규칙 5: 관리자만 생성/수정/삭제 가능
**설명**: 추천 문장은 일반 사용자가 추가하거나 변경할 수 없으며, 관리자만 관리할 수 있습니다.
**예시**: 관리자가 관리자 페이지에서 새 추천 문장 "방 열쇠 주세요"를 추가하면 모든 사용자가 사용할 수 있습니다.
**위반 시**: 일반 사용자의 생성/수정 시도는 "FORBIDDEN" 오류로 거부됩니다.

---

### 규칙 6: 수정 시 음성 재생성
**설명**: 추천 문장의 텍스트를 수정하면 음성 파일도 자동으로 재생성됩니다.
**예시**: "여기서 내려주세요"를 "여기에서 내려주세요"로 수정하면 TTS API로 새 음성 파일을 생성합니다.
**위반 시**: 음성이 재생성되지 않으면 텍스트와 음성이 불일치할 수 있습니다.

---

### 규칙 7: 삭제 시 음성 파일도 제거
**설명**: 추천 문장을 삭제하면 연결된 음성 파일도 Cloud Storage에서 함께 삭제됩니다.
**예시**: 더 이상 사용하지 않는 "공중전화 어디 있나요?" 문장을 삭제하면 음성 파일도 자동 삭제됩니다.
**위반 시**: 음성 파일이 남아있으면 저장 공간이 낭비됩니다.

---

## 제약 조건

### 규칙 8: 미션 타입당 3-5개 권장
**설명**: 각 미션 타입당 3-5개의 추천 문장을 제공하는 것이 권장됩니다. 너무 많으면 선택이 어렵고, 너무 적으면 활용도가 낮습니다.
**예시**: 택시 미션에는 "여기서 내려주세요", "얼마예요?", "영수증 주세요" 3개가 제공됩니다.
**위반 시**: 3개 미만이거나 5개 초과도 허용되지만 사용성이 떨어질 수 있습니다.

---

### 규칙 9: 다국어 확장 가능
**설명**: 한국어/영어는 DB에 미리 저장하지만, 향후 일본어/중국어 추가 시 새 필드를 추가할 수 있습니다.
**예시**: JapaneseText, ChineseText 필드를 추가하거나 별도 Translation 테이블로 관리할 수 있습니다.
**위반 시**: 초기 버전은 한국어/영어만 지원합니다.

---

## 성능 규칙

### 규칙 10: 음성 파일 미리 생성
**설명**: 추천 문장의 음성은 미리 TTS로 생성하여 저장하므로 실시간 TTS 호출이 없어 빠릅니다.
**예시**: "여기서 내려주세요" 음성은 관리자가 추천 문장을 생성할 때 미리 만들어져 Cloud Storage에 저장됩니다.
**위반 시**: 음성이 없으면 클라이언트에서 실시간 TTS를 호출하여 응답이 느려집니다.

---

### 규칙 11: 음성 파일 캐싱
**설명**: 음성 파일은 클라이언트에 캐싱되어 반복 재생 시 네트워크 요청이 없습니다.
**예시**: "여기서 내려주세요" 음성을 한 번 다운로드하면 앱이 종료될 때까지 캐시에서 재생됩니다.
**위반 시**: 캐싱 없이 매번 다운로드하면 데이터 사용량이 증가합니다.

---

## 연계 규칙

### 규칙 12: 미션과 추천 문장 연계
**설명**: 미션 타입에 따라 해당 타입의 추천 문장만 제공됩니다. 택시 미션에는 택시용 추천 문장만 표시됩니다.
**예시**: 택시 미션 중에는 "여기서 내려주세요"가 보이지만, "카드 되나요?"는 보이지 않습니다.
**위반 시**: 다른 타입의 추천 문장은 필터링됩니다.

---

### 규칙 13: 번역 기록 생성 없음
**설명**: 추천 문장을 사용해도 번역 기록(Translation)이 생성되지 않습니다. 추천 문장은 템플릿이므로 기록할 필요가 없습니다.
**예시**: 사용자가 "여기서 내려주세요" 카드를 10번 사용해도 번역 기록은 생성되지 않습니다.
**위반 시**: 필요 시 별도 PhraseUsageLog 테이블을 생성하여 사용 통계를 수집할 수 있습니다.

---

## 권한 규칙

### 규칙 14: 일반 사용자는 조회만 가능
**설명**: 일반 사용자는 추천 문장을 조회하고 사용할 수만 있으며, 추가/수정/삭제는 불가능합니다.
**예시**: 사용자는 택시 미션에서 제공되는 추천 문장을 보고 선택할 수만 있습니다.
**위반 시**: 생성/수정/삭제 시도는 "FORBIDDEN" 오류로 거부됩니다.

---

### 규칙 15: 관리자 전용 API
**설명**: 추천 문장의 생성, 수정, 삭제는 관리자 전용 API를 통해서만 가능합니다.
**예시**: 관리자는 `/admin/phrases` API로 새 추천 문장을 추가하거나 기존 문장을 수정할 수 있습니다.
**위반 시**: 일반 사용자는 이 API에 접근할 수 없습니다.

---

## 확장 규칙

### 규칙 16: 단계별 추천 문장
**설명**: 향후 미션의 각 단계별로 서로 다른 추천 문장을 제공할 수 있습니다.
**예시**: 택시 미션 1단계(목적지 설정)에는 "어디로 가나요?", 3단계(하차)에는 "여기서 내려주세요"를 제공합니다.
**위반 시**: 초기 버전은 미션 타입별로만 구분하고 단계별 구분은 없습니다.
